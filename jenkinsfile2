pipeline{
    agent { label "master" }

    environment { 
        ECR_REGISTRY = ""
    }

    stages {
        stage("Create ECR Repo") {
            steps {
            echo "Creating ECR Repository"
            }
        }
        stage("Build APP Docker Images"){
            steps {
                echo "Building App Docker images"
            }
        }
        stage("Push APP Docker Images to ECR"){
            steps {
                echo "Pushing images to ECR"
            }
        }
        stage("Create Infrastructure"){
            steps {
                echo "Testing if Dcker Swarm is ready or not"
            }
        }
        stage("Deploy the App on Docker Swarm"){
            step {
                echo "DEploying the app"
            }
        }
        stage("Test the application"){
            steps { 
                echo "Check if the application is ready or not"
            }
        }
    }
    post {
        always{
            echo "Deleting all local images"
        }
        failure {
            echo "Deleting the image repository on ECR due to failure""
            echo "Deleting the cloudformation steck due to failure"
        }
    }
}